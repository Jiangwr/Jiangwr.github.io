<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Spring IoC 容器的启动过程 | jiangwr</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Spring IoC 容器的启动过程</h1><a id="logo" href="/.">jiangwr</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Spring IoC 容器的启动过程</h1><div class="post-meta">Apr 29, 2019</div><div class="post-content"><p>学习一波日常在用的 IoC 容器的启动过程。</p>
<a id="more"></a>
<h2 id="IoC-相关的基本概念"><a href="#IoC-相关的基本概念" class="headerlink" title="IoC 相关的基本概念"></a>IoC 相关的基本概念</h2><h3 id="IoC-Inversion-of-Control-的概念"><a href="#IoC-Inversion-of-Control-的概念" class="headerlink" title="IoC (Inversion of Control)的概念"></a>IoC (Inversion of Control)的概念</h3><p>​    IoC，即为控制反转，不是一门技术，而是一种设计思想。在 Java 开发中，IoC 意味着将设计好的对象交给 IoC容器控制，而不是传统的在对象内部直接控制。对于 Spring 框架而言，就是由 Spring 来负责控制对象的生命周期和对象间的关系。</p>
<h3 id="IoC-的优势"><a href="#IoC-的优势" class="headerlink" title="IoC 的优势"></a>IoC 的优势</h3><p>​    传统的应用程序都是在类内部主动创建依赖对象，从而导致了类与类之间的高耦合，难以测试。有了 IoC 容器之后，把创建和查找依赖的对象的控制权交给 IoC 容器，由容器进行注入对象，所以对象与对象之间是低耦合的，这样利于测试，也方便功能服用，更重要的是使得程序的整个体系结构变得更加灵活了。</p>
<h3 id="DI-Dependency-Injection-的概念"><a href="#DI-Dependency-Injection-的概念" class="headerlink" title="DI(Dependency Injection)的概念"></a>DI(Dependency Injection)的概念</h3><p>​    DI，即为依赖注入。把底层类作为参数传递给上层类，实现上层对下层的”控制”。DI可以实现在程序运行时，动态地向某个对象提供它所需要的其他对象。在 Java1.3 之后有一个重要特性是反射(reflection),它允许在运行时动态的生成对象、执行对象的方法、改变对象的属性，Spring 就是通过反射来实现依赖注入的。</p>
<h3 id="IoC与DI-的关系"><a href="#IoC与DI-的关系" class="headerlink" title="IoC与DI 的关系"></a>IoC与DI 的关系</h3><p>其实它们是同一个概念的不同角度描述。2004年，Martin Fowler 探讨了同一个问题，既然 IOC 是控制反转，那么到底是“哪些方面的控制被反转了呢？”，经过详细地分析和论证后，他得出了答案：“获得依赖对象的过程被反转了”。控制被反转之后，获得依赖对象的过程由自身管理变为了由IOC容器主动注入。于是，他给“控制反转”取了一个更合适的名字叫做“依赖注入（Dependency Injection）”。</p>
<h2 id="Spring-项目的基本结构"><a href="#Spring-项目的基本结构" class="headerlink" title="Spring 项目的基本结构"></a>Spring 项目的基本结构</h2><p><img src="/2019/04/29/Spring-IoC-容器的启动过程/Spring 项目的基本目录结构.png" alt=""></p>
<p>pom.xml 文件:</p>
<p>需要注意的是，spring-context 会自动将 spring-core、spring-beans、spring-aop、spring-expression 这几个基础 jar 包带进来。所以不需要引入太多东西。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring.helloworld<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--spring-context 会自动将 spring-core、spring-beans、spring-aop、spring-expression 这几个基础 jar 包带进来。--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.11.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>MessageService.java</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public<span class="built_in"> interface </span>MessageService &#123;</span><br><span class="line">    String getMessage();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>MessageServiceImpl.java</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageServiceImpl</span> <span class="keyword"><span class="keyword">implements</span> <span class="type">MessageService</span></span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">String</span> getMessage() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello Spring"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>App.java</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">App</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String[] args</span>)</span> &#123;</span><br><span class="line">        <span class="comment">//用配置文件来启动一个 ApplicationContext</span></span><br><span class="line">        ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"classpath:application.xml"</span>);</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"context 启动成功"</span>);</span><br><span class="line">        <span class="comment">//从 context 中取出 Bean</span></span><br><span class="line">        MessageService messageService = context.getBean(MessageService.class);</span><br><span class="line">        System.<span class="keyword">out</span>.println(context.getBean(<span class="string">"lol"</span>).getClass());</span><br><span class="line">        System.<span class="keyword">out</span>.println(messageService.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>application.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span> <span class="attr">default-autowire</span>=<span class="string">"byName"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"messageService"</span> <span class="attr">name</span>=<span class="string">"lol"</span> <span class="attr">class</span>=<span class="string">"com.spring.hello.service.serviceImpl.MessageServiceImpl"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>启动 app.java </p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">context 启动成功</span><br><span class="line">class com.spring.hello.service.serviceImpl.MessageServiceImpl</span><br><span class="line">Hello Spring</span><br><span class="line"></span><br><span class="line">Process finished with <span class="keyword">exit</span> code <span class="number">0</span></span><br></pre></td></tr></table></figure>
<h2 id="创建-IoC-容器的-refesh-方法"><a href="#创建-IoC-容器的-refesh-方法" class="headerlink" title="创建 IoC 容器的 refesh() 方法"></a>创建 IoC 容器的 refesh() 方法</h2><p><code>ApplicationContext context = new ClassPathXmlApplicationContext(&quot;classpath:application.xml&quot;);</code>通过 IDEA 查看该代码的源码是跳到了 ClassPathXmlApplicationContext.class 40 行的如下方法。</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ClassPathXmlApplicationContext</span><span class="params">(String[] configLocations, <span class="keyword">boolean</span> refresh, ApplicationContext parent)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(parent);</span><br><span class="line">    <span class="keyword">this</span>.setConfigLocations(configLocations);</span><br><span class="line">    <span class="keyword">if</span> (refresh) &#123;</span><br><span class="line">        <span class="keyword">this</span>.refresh();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>refresh() 方法在 AbstractApplicationContext.class 的 254 行</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> void refresh() throws BeansException, IllegalStateException &#123;</span><br><span class="line">		<span class="comment">//加锁保证保证创建应用上下文的时候线程安全</span></span><br><span class="line">    synchronized(<span class="keyword">this</span>.startupShutdownMonitor) &#123;</span><br><span class="line">    		<span class="comment">//记录容器的启动时间、设置为已启动状态、处理配置文件的占位符</span></span><br><span class="line">        <span class="keyword">this</span>.prepareRefresh();</span><br><span class="line">        <span class="comment">//将配置文件中的 bean 标签解析成 BeanDefinition</span></span><br><span class="line">        <span class="comment">//注册到 BeanFactory 中(beanName -&gt; beanDefinition 的 map </span></span><br><span class="line">        <span class="comment">//该 map 为 ConcurrentHashMap)</span></span><br><span class="line">        ConfigurableListableBeanFactory beanFactory = <span class="keyword">this</span>.obtainFreshBeanFactory();</span><br><span class="line">        <span class="comment">//设置 BeanFactory 的类加载器，添加 BeanPostProcessor，注册几个特殊的Bean</span></span><br><span class="line">        <span class="keyword">this</span>.prepareBeanFactory(beanFactory);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">     <span class="comment">// 【这里需要知道 BeanFactoryPostProcessor 这个知识点，Bean 如果实现了此接口，</span></span><br><span class="line">     <span class="comment">// 那么在容器初始化以后，Spring 会负责调用里面的 postProcessBeanFactory 方法。】</span></span><br><span class="line">     <span class="comment">// 这里是提供给子类的扩展点，到这里的时候，所有的 Bean 都加载、注册完成了，但是都还没有初始化</span></span><br><span class="line">     <span class="comment">// 具体的子类可以在这步的时候添加一些特殊的 BeanFactoryPostProcessor 的实现类或做点什么事</span></span><br><span class="line">            <span class="keyword">this</span>.postProcessBeanFactory(beanFactory);</span><br><span class="line">            </span><br><span class="line">     <span class="comment">// 调用 BeanFactoryPostProcessor 各个实现类的 postProcessBeanFactory(factory) 方法</span></span><br><span class="line">            <span class="keyword">this</span>.invokeBeanFactoryPostProcessors(beanFactory);</span><br><span class="line">     <span class="comment">// 注册 BeanPostProcessor 的实现类，注意看和 BeanFactoryPostProcessor 的区别</span></span><br><span class="line">     <span class="comment">// 此接口两个方法: postProcessBeforeInitialization 和 postProcessAfterInitialization</span></span><br><span class="line">     <span class="comment">// 两个方法分别在 Bean 初始化之前和初始化之后得到执行。注意，到这里 Bean 还没初始化</span></span><br><span class="line">            <span class="keyword">this</span>.registerBeanPostProcessors(beanFactory);</span><br><span class="line">     <span class="comment">// 初始化当前 ApplicationContext 的 MessageSource，国际化</span></span><br><span class="line">            <span class="keyword">this</span>.initMessageSource();</span><br><span class="line">     <span class="comment">// 初始化当前 ApplicationContext 的事件广播器</span></span><br><span class="line">            <span class="keyword">this</span>.initApplicationEventMulticaster();</span><br><span class="line">            </span><br><span class="line">     <span class="comment">// 钩子方法，具体的子类可以在这里初始化一些特殊的 Bean（在初始化 singleton beans 之前）</span></span><br><span class="line">            <span class="keyword">this</span>.onRefresh();</span><br><span class="line">     <span class="comment">// 注册事件监听器，监听器需要实现 ApplicationListener 接口。</span></span><br><span class="line">            <span class="keyword">this</span>.registerListeners();</span><br><span class="line">     <span class="comment">// 初始化所有的 singleton beans（lazy-init 的除外） 非常重要非常重要非常重要</span></span><br><span class="line">            <span class="keyword">this</span>.finishBeanFactoryInitialization(beanFactory);</span><br><span class="line">     <span class="comment">// 最后，广播事件，ApplicationContext 初始化完成</span></span><br><span class="line">            <span class="keyword">this</span>.finishRefresh();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (BeansException var9) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.logger.isWarnEnabled()) &#123;</span><br><span class="line">                <span class="keyword">this</span>.logger.warn(<span class="string">"Exception encountered during context initialization - cancelling refresh attempt: "</span> + var9);</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">// 销毁已经初始化的 singleton 的 Beans，以免有些 bean 会一直占用资源</span></span><br><span class="line">            <span class="keyword">this</span>.destroyBeans();</span><br><span class="line">            <span class="keyword">this</span>.cancelRefresh(var9);</span><br><span class="line">            <span class="keyword">throw</span> var9;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.resetCommonCaches();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="refesh-中的-obtainFreshBeanFactory-方法"><a href="#refesh-中的-obtainFreshBeanFactory-方法" class="headerlink" title="refesh() 中的 obtainFreshBeanFactory() 方法"></a>refesh() 中的 obtainFreshBeanFactory() 方法</h3><ol>
<li><p>判断当前 ApplicationContext 是否加载过 BeanFactory，如果已经有了，就销毁所有 Bean,关闭 BeanFactory。</p>
</li>
<li><p>初始化一个 DefaultListableBeanFactory 用于 BeanFactory 的序列化。</p>
</li>
<li>设置 BeanFactory 的配置属性:是否允许 Bean 覆盖、是否允许循环引用。默认情况下 Spring 允许循环引用。如果在配置文件中定义 bean 时使用了相同的 id 或者 name，若在同一个配置文件会直接抛出异常，在不同配置文件中，会发生 Bean 覆盖。Spring 默认不同文件是可以覆盖的。</li>
<li>通过 XmlBeanDefinitionReader 的实例来加载 bean 到 BeanFactory 中(其中会把 XML 文件转换成 Document 对象)，在解析方法 parseBeanDefinitions() 可以知道解析分成两个路径，一是解析 default namespace 下面的元素(<import>、<alias>、<bean>、<beans>),二是解析其他 namespace 下面的元素。</beans></bean></alias></import></li>
<li>根据 <bean ...="">…</bean> 中的配置创建 BeanDefinition 实例，然后把配置中的信息都设置到实例中。</li>
<li>注册 bean(Map&lt;String, BeanDefinition&gt; beanDefinitionMap) ，如果 beanName 重复，在允许 bean 覆盖的时候后面的直接覆盖 bean，否则抛出异常。</li>
</ol>
<p><em>相关知识点</em>:</p>
<p><strong>DefaultListableBeanFactory</strong></p>
<p>首先 ApplicationContext 继承自 BeanFactory,但是其内部也持有了一个实例化的 BeanFactory(DefaultListableBeanFactory)。所有 BeanFactory 相关的操作都会委托给这个实例来处理。 DefaultListableBeanFactory 可以说是最厉害的BeanFactory，他实现了所有 BeanFacorty 下的相关接口。</p>
<p><strong>default namespace</strong> </p>
<p>default namespace 是指 <code>http://www.springframework.org/schema/beans</code>。<code>&lt;import/&gt;</code>、<code>&lt;alias&gt;</code>、<code>&lt;bean&gt;</code>、<code>&lt;beans&gt;</code>这四个标签都是在该 namespace 下定义的。</p>
<p>下面代码的第二行的 <strong>xmlns</strong> 就是该 namespcae</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;beans xmlns:<span class="attribute">xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">       <span class="attribute">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span><br><span class="line">       xsi:<span class="attribute">schemaLocation</span>=<span class="string">"</span></span><br><span class="line"><span class="string">            http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">          http://www.springframework.org/schema/beans/spring-beans.xsd"</span></span><br><span class="line">       <span class="attribute">default-autowire</span>=<span class="string">"byName"</span>&gt;</span><br></pre></td></tr></table></figure>
<p>对于其他的标签，比如经常会使用到的 <code>&lt;mvc /&gt;</code>、<code>&lt;task /&gt;</code>、<code>&lt;context /&gt;</code>、<code>&lt;aop /&gt;</code>等</p>
<h3 id="refesh-中的-finishBeanFactoryInitialization-beanFactory-方法"><a href="#refesh-中的-finishBeanFactoryInitialization-beanFactory-方法" class="headerlink" title="refesh() 中的 finishBeanFactoryInitialization(beanFactory) 方法"></a>refesh() 中的 finishBeanFactoryInitialization(beanFactory) 方法</h3><p>在执行这个方法之前。BeanFactory 已经创建完成，并且所有的实现了 BeanFactoryPostProcessor 接口的 Bean 都已经初始化并且其中的 postProcessBeanFactory(factory) 方法已经得到回调执行了。而且 Spring 已经“手动”注册了一些特殊的 Bean，如 ‘environment’、‘systemProperties’ 等。剩下的任务就是初始化 singleton beans 了，如果没有设置懒加载，那么 Spring 会在接下来初始化所有的 singleton beans。</p>
<ol>
<li>触发所有的非懒加载的 singleton beans 的初始化操作</li>
<li>getBean() 方法获取 Bean ，如果未被创建，则通过 createBean() 方法进行创建</li>
<li>createBean() 中实例化对象并且设置属性值</li>
</ol>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://javadoop.com/post/spring-ioc" target="_blank" rel="noopener">Spring IOC 容器源码分析</a></p>
</div><div class="tags"><a href="/tags/Spring/">Spring</a></div><div class="post-nav"><a class="pre" href="/2019/05/11/Springboot打包时引入本地的jar包/">Springboot打包时引入本地的jar包</a><a class="next" href="/2019/04/11/《Redis设计与实现》读薄/">《Redis设计与实现》读薄</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/JVM/">JVM</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/">MySQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Scala/">Scala</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web技术/">Web技术</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/书籍阅读/">书籍阅读</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/开发经验/">开发经验</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据结构与算法/">数据结构与算法</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/">设计模式</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Spring/" style="font-size: 15px;">Spring</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/07/10/Scala-中的尾递归/">Scala 中的尾递归</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/06/28/解决-MacOS-下-sbt-加载慢的问题/">解决 MacOS 下 sbt 加载慢的问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/06/23/Spring-中的组件注册/">Spring 中的组件注册</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/06/12/位运算的相关知识/">位运算的常见使用方式</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/28/离职同事留下的日期格式BUG/">离职同事留下的日期获取异常的BUG</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/27/算法-基础排序/">算法-基础排序</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/20/JVM的运行时数据区域、垃圾回收以及类加载机制/">JVM的运行时数据区域、垃圾回收以及类加载机制</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/13/把《高性能MySQL》读薄/">把《高性能MySQL》读薄</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/11/Springboot打包时引入本地的jar包/">Springboot打包时引入本地的jar包</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/29/Spring-IoC-容器的启动过程/">Spring IoC 容器的启动过程</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">jiangwr</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>